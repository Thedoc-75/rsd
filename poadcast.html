<section id="podcast" style="background:#101011; color:#fff; padding:40px;">
  <div style="max-width:1200px; margin:auto;">
    <h2 style="color:#ff8013; text-align:center; font-family:'Lato', sans-serif; font-weight:700; margin-bottom:30px;">
      ðŸŽ§ - Emergency Medicine Cases - 
    </h2>

    <!-- Contenitore carosello -->
    <div class="carousel-container">
      <button class="carousel-btn prev">&#10094;</button>
      <div class="carousel-track" id="podcast-track"></div>
      <button class="carousel-btn next">&#10095;</button>
    </div>
  </div>
</section>

<style>
.carousel-container {
  position: relative;
  overflow: hidden;
}

.carousel-track {
  display: flex;
  gap: 20px;
  transition: transform 0.4s ease;
}

.podcast-card {
  background: #1b1b1d;
  border-radius: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  flex: 0 0 300px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.podcast-card-content {
  padding: 15px;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.podcast-card-content h3 {
  font-size: 1rem;
  margin-bottom: 5px;
}

.podcast-card-content h3 a {
  color: #ff8013;
  text-decoration: none;
}

.podcast-card-content p {
  color: #ccc;
  font-size: 0.85em;
  margin-bottom: 10px;
}

.carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: rgba(0,0,0,0.5);
  color: white;
  border: none;
  font-size: 2rem;
  cursor: pointer;
  padding: 5px 10px;
  border-radius: 50%;
  z-index: 10;
}

.carousel-btn.prev { left: 10px; }
.carousel-btn.next { right: 10px; }

audio {
  width: 100%;
}
</style>

<script>
const feedUrl = 'https://emergencymedicinecases.com/feed/';

let currentPosition = 0;
const cardWidth = 320; // card + gap
let totalCards = 0;

function slideNext(track) {
  if (currentPosition > -(cardWidth * (totalCards - 3))) {
    currentPosition -= cardWidth;
  } else {
    currentPosition = 0;
  }
  track.style.transform = `translateX(${currentPosition}px)`;
}

function slidePrev(track) {
  if (currentPosition < 0) {
    currentPosition += cardWidth;
  } else {
    currentPosition = -(cardWidth * (totalCards - 3));
  }
  track.style.transform = `translateX(${currentPosition}px)`;
}

fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`)
  .then(res => res.json())
  .then(data => {
    const track = document.getElementById('podcast-track');
    totalCards = data.items.length;

    data.items.forEach(item => {
      const card = document.createElement('div');
      card.classList.add('podcast-card');

      const content = document.createElement('div');
      content.classList.add('podcast-card-content');

      const title = document.createElement('h3');
      title.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a>`;

      const date = document.createElement('p');
      date.textContent = new Date(item.pubDate).toLocaleDateString('it-IT');

      const audio = document.createElement('audio');
      if (item.enclosure && item.enclosure.link && item.enclosure.type.includes('audio')) {
        audio.controls = true;
        audio.src = item.enclosure.link;
      }

      content.appendChild(title);
      content.appendChild(date);
      content.appendChild(audio);

      card.appendChild(content);
      track.appendChild(card);
    });

    document.querySelector('.carousel-btn.next').addEventListener('click', () => slideNext(track));
    document.querySelector('.carousel-btn.prev').addEventListener('click', () => slidePrev(track));

    setInterval(() => slideNext(track), 8000);
  })
  .catch(err => {
    console.error('Errore nel caricamento del feed:', err);
    document.getElementById('podcast-track').innerHTML = '<p>Impossibile caricare il podcast.</p>';
  });
</script>
