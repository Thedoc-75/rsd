<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Podcast</title>
  <style>
    body {
      margin: 0;
      background: #101011;
      color: #fff;
      font-family: 'Lato', sans-serif;
    }

    h2 {
      color: #ff8013;
      text-align: center;
      font-weight: 700;
      margin: 30px 0;
    }

    .carousel-container {
      position: relative;
      overflow: hidden;
      padding: 0 20px;
      box-sizing: border-box;
    }

    .carousel-track {
      display: flex;
      gap: 20px;
      transition: transform 0.4s ease;
    }

    .podcast-card {
      background: #1b1b1d;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      flex: 0 0 300px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .podcast-card-content {
      padding: 15px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .podcast-card-content h3 {
      font-size: 1rem;
      margin-bottom: 5px;
    }

    .podcast-card-content h3 a {
      color: #ff8013;
      text-decoration: none;
    }

    .podcast-card-content p {
      color: #ccc;
      font-size: 0.85em;
      margin-bottom: 10px;
    }

    audio {
      width: 100%;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .carousel-container {
        padding: 0 15px;
      }
      .podcast-card {
        flex: 0 0 250px;
      }
    }

    @media (max-width: 480px) {
      .carousel-container {
        padding: 0 10px;
      }
      .carousel-track {
        gap: 10px;
      }
      .podcast-card {
        flex: 0 0 100%;
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

  <section id="podcast">
    <div style="max-width:1200px; margin:auto;">
      <h2>ðŸŽ§ - Emergency Medicine Cases -</h2>

      <div class="carousel-container">
        <div class="carousel-track" id="podcast-track"></div>
      </div>
    </div>
  </section>

  <script>
    const feedUrl = 'https://emergencymedicinecases.com/feed/';

    let currentPosition = 0;
    let cardWidth = 320;
    let totalCards = 0;
    let visibleCards = 3;

    function updateCarouselSettings() {
      if (window.innerWidth <= 480) {
        cardWidth = document.querySelector('.podcast-card')?.offsetWidth || 300;
        visibleCards = 1;
      } else if (window.innerWidth <= 768) {
        cardWidth = document.querySelector('.podcast-card')?.offsetWidth || 250;
        visibleCards = 2;
      } else {
        cardWidth = 320;
        visibleCards = 3;
      }
    }

    function slideNext(track) {
      if (currentPosition > -(cardWidth * (totalCards - visibleCards))) {
        currentPosition -= cardWidth;
      } else {
        currentPosition = 0;
      }
      track.style.transform = `translateX(${currentPosition}px)`;
    }

    function sendHeight() {
      const height = document.documentElement.scrollHeight;
      window.parent.postMessage({ iframeHeight: height }, "*");
    }

    fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}`)
      .then(res => res.json())
      .then(data => {
        const track = document.getElementById('podcast-track');
        totalCards = data.items.length;

        data.items.forEach(item => {
          const card = document.createElement('div');
          card.classList.add('podcast-card');

          const content = document.createElement('div');
          content.classList.add('podcast-card-content');

          const title = document.createElement('h3');
          title.innerHTML = `<a href="${item.link}" target="_blank">${item.title}</a>`;

          const date = document.createElement('p');
          date.textContent = new Date(item.pubDate).toLocaleDateString('it-IT');

          const audio = document.createElement('audio');
          if (item.enclosure && item.enclosure.link && item.enclosure.type.includes('audio')) {
            audio.controls = true;
            audio.src = item.enclosure.link;
          }

          content.appendChild(title);
          content.appendChild(date);
          content.appendChild(audio);
          card.appendChild(content);
          track.appendChild(card);
        });

        updateCarouselSettings();
        window.addEventListener('resize', () => {
          updateCarouselSettings();
          sendHeight();
        });

        setInterval(() => slideNext(track), 8000);

        // Altezza iniziale
        sendHeight();
      })
      .catch(err => {
        console.error('Errore nel caricamento del feed:', err);
        document.getElementById('podcast-track').innerHTML = '<p>Impossibile caricare il podcast.</p>';
        sendHeight();
      });

    window.addEventListener("load", sendHeight);
    window.addEventListener("resize", sendHeight);
    setInterval(sendHeight, 2000);
  </script>
</body>
</html>
